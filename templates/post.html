{{define "post.html"}}
    {{template "header" .}}
    <div class="post-page">
        {{ with .Post }}
            <article class="post">
                {{ if .Categories }}
                    <div class="post-categories">
                        Categories: {{ range $index, $category := .Categories }}{{ if $index }}, {{ end }}{{ $category }}{{ end }}
                    </div>
                {{ end }}
                <h1>{{ .Title }}</h1>
                <div class="post-meta">
                    <time>{{ .CreatedAt }}</time>
                    <span class="author">By {{ .Username }}</span>
                </div>
                
                <div class="post-content">
                    {{ .Content }}
                </div>

                <div class="reactions">
                    {{ if $.User }}
                        <button class="like-btn {{ if .UserLiked }}active{{ end }}" 
                                data-post-id="{{ .ID }}" 
                                data-type="like">
                            👍 {{ .Likes }}
                        </button>
                        <button class="dislike-btn {{ if .UserDisliked }}active{{ end }}" 
                                data-post-id="{{ .ID }}" 
                                data-type="dislike">
                            👎 {{ .Dislikes }}
                        </button>
                    {{ else }}
                        <span class="reaction-count">👍 {{ .Likes }}</span>
                        <span class="reaction-count">👎 {{ .Dislikes }}</span>
                    {{ end }}
                </div>

                {{ if and $.User (eq $.User.ID .UserID) }}
                    <div class="post-actions">
                        <a href="/post/edit/{{ .ID }}" class="edit-btn">✏️ Edit</a>
                        <button class="delete-btn" data-post-id="{{ .ID }}">🗑️ Delete</button>
                    </div>
                {{ end }}
            </article>

            <div class="comments-section" id="comments">
                <h2>Comments</h2>
                {{ if $.User }}
                    <form class="comment-form" action="/api/comment" method="POST">
                        <input type="hidden" name="post_id" value="{{ .ID }}">
                        <textarea name="content" placeholder="Write your comment here"></textarea>
                        <button type="submit">Submit</button>
                    </form>
                {{ else }}
                    <p>Please <a href="/login">login</a> to leave comments.</p>
                {{ end }}

                <div class="comments-list">
                    {{ range $.CommentDataList }}
                        {{template "comment" .}}
                    {{ end }}
                </div>
            </div>
        {{ end }}
    </div>
    <script src="/static/js/reactions.js"></script>
    <script src="/static/js/comments.js"></script>
    {{template "footer" .}}
{{end}} 